### TOUS LES GENRES MUSICAUX (200+ GENRES)

FLOWTAG_GENRES = {
    # === POP ===
    'Pop': {
        'contexts': ['#Mariage', '#Anniversaire', '#CorporateEvent', '#Bar'],
        'subgenres': [
            'Dance Pop', 'Electropop', 'Indie Pop', 'Pop Rock', 'Power Pop',
            'Synthpop', 'Teen Pop', 'Adult Contemporary', 'Bubblegum Pop',
            'Chamber Pop', 'Dream Pop', 'K-Pop', 'J-Pop', 'Latin Pop',
            'Pop Punk', 'Pop Rap', 'Progressive Pop', 'Psychedelic Pop',
            'Europop', 'Afropop', 'Arabic Pop', 'C-Pop', 'Cantopop'
        ]
    },
    
    # === ROCK ===
    'Rock': {
        'contexts': ['#Bar', '#Festival', '#Anniversaire'],
        'subgenres': [
            'Alternative Rock', 'Classic Rock', 'Hard Rock', 'Indie Rock',
            'Progressive Rock', 'Punk Rock', 'Garage Rock', 'Glam Rock',
            'Grunge', 'Post-Rock', 'Psychedelic Rock', 'Soft Rock',
            'Southern Rock', 'Surf Rock', 'Arena Rock', 'Art Rock',
            'Blues Rock', 'Folk Rock', 'Funk Rock', 'Gothic Rock',
            'Krautrock', 'Math Rock', 'Noise Rock', 'Post-Punk'
        ]
    },
    
    # === ELECTRONIC/DANCE ===
    'Electronic': {
        'contexts': ['#Club', '#Festival', '#PoolParty'],
        'subgenres': [
            'House', 'Deep House', 'Tech House', 'Progressive House',
            'Tropical House', 'Future House', 'Electro House', 'Big Room',
            'Techno', 'Minimal Techno', 'Detroit Techno', 'Acid Techno',
            'Trance', 'Progressive Trance', 'Psytrance', 'Uplifting Trance',
            'Drum and Bass', 'Liquid DnB', 'Neurofunk', 'Jump Up',
            'Dubstep', 'Future Garage', 'Brostep', 'Riddim',
            'Trap', 'Future Bass', 'Hardstyle', 'Hardcore', 'Gabber',
            'Ambient', 'Downtempo', 'Trip Hop', 'IDM', 'Breakbeat',
            'Garage', 'UK Garage', '2-Step', 'Grime', 'Bassline'
        ]
    },
    
    # === HIP-HOP/RAP ===
    'Hip-Hop': {
        'contexts': ['#Club', '#Bar', '#Anniversaire', '#Festival'],
        'subgenres': [
            'Boom Bap', 'Trap', 'Mumble Rap', 'Conscious Rap',
            'Gangsta Rap', 'Alternative Hip-Hop', 'Jazz Rap',
            'G-Funk', 'Crunk', 'Drill', 'UK Drill', 'Grime',
            'Cloud Rap', 'Emo Rap', 'Old School Hip-Hop',
            'East Coast Hip-Hop', 'West Coast Hip-Hop', 'Southern Hip-Hop',
            'French Rap', 'German Hip-Hop', 'Latin Trap', 'Afrobeat Rap'
        ]
    },
    
    # === R&B/SOUL ===
    'R&B': {
        'contexts': ['#CocktailChic', '#Restaurant', '#Bar', '#Club'],
        'subgenres': [
            'Contemporary R&B', 'Neo Soul', 'Funk', 'Disco',
            'Classic Soul', 'Motown', 'Philadelphia Soul',
            'Alternative R&B', 'PBR&B', 'Quiet Storm',
            'New Jack Swing', 'Rhythm and Blues', 'Doo-Wop',
            'Northern Soul', 'Southern Soul', 'Blue-Eyed Soul',
            'Psychedelic Soul', 'Afrobeat', 'Boogie'
        ]
    },
    
    # === JAZZ ===
    'Jazz': {
        'contexts': ['#CocktailChic', '#Restaurant', '#CorporateEvent'],
        'subgenres': [
            'Smooth Jazz', 'Bebop', 'Cool Jazz', 'Hard Bop',
            'Free Jazz', 'Fusion', 'Latin Jazz', 'Acid Jazz',
            'Nu Jazz', 'Jazz Funk', 'Soul Jazz', 'Swing',
            'Dixieland', 'Ragtime', 'Bossa Nova', 'Afro-Cuban Jazz',
            'Gypsy Jazz', 'Modal Jazz', 'Post-Bop', 'Third Stream'
        ]
    },
    
    # === LATIN ===
    'Latin': {
        'contexts': ['#Club', '#PoolParty', '#Festival', '#Mariage'],
        'subgenres': [
            'Reggaeton', 'Salsa', 'Bachata', 'Merengue',
            'Cumbia', 'Vallenato', 'Latin Pop', 'Latin Rock',
            'Tango', 'Samba', 'Bossa Nova', 'Rumba',
            'Mambo', 'Cha-Cha-Cha', 'Bolero', 'Ranchera',
            'Mariachi', 'Banda', 'Norteño', 'Tejano',
            'Flamenco', 'Latin Jazz', 'Perreo', 'Dembow'
        ]
    },
    
    # === REGGAE/CARIBBEAN ===
    'Reggae': {
        'contexts': ['#PoolParty', '#Bar', '#Festival', '#Brunch'],
        'subgenres': [
            'Roots Reggae', 'Dub', 'Dancehall', 'Ragga',
            'Ska', 'Rocksteady', 'Lovers Rock', 'Reggae Fusion',
            'Soca', 'Calypso', 'Afrobeats', 'Zouk',
            'Kompa', 'Reggae Pop', 'Conscious Reggae'
        ]
    },
    
    # === COUNTRY ===
    'Country': {
        'contexts': ['#Bar', '#CorporateEvent', '#Mariage'],
        'subgenres': [
            'Contemporary Country', 'Country Pop', 'Country Rock',
            'Outlaw Country', 'Alternative Country', 'Bluegrass',
            'Honky Tonk', 'Nashville Sound', 'Bakersfield Sound',
            'Texas Country', 'Country Folk', 'Western Swing',
            'Americana', 'Country Blues', 'Country Rap'
        ]
    },
    
    # === FOLK/ACOUSTIC ===
    'Folk': {
        'contexts': ['#Restaurant', '#CocktailChic', '#Brunch'],
        'subgenres': [
            'Contemporary Folk', 'Indie Folk', 'Folk Rock',
            'Traditional Folk', 'Celtic Folk', 'Bluegrass',
            'Singer-Songwriter', 'New Folk', 'Anti-Folk',
            'Freak Folk', 'Folk Pop', 'World Folk'
        ]
    },
    
    # === BLUES ===
    'Blues': {
        'contexts': ['#Bar', '#Restaurant', '#CocktailChic'],
        'subgenres': [
            'Electric Blues', 'Delta Blues', 'Chicago Blues',
            'Texas Blues', 'Blues Rock', 'Contemporary Blues',
            'Jump Blues', 'Piano Blues', 'Soul Blues',
            'Swamp Blues', 'British Blues', 'Blues Jazz'
        ]
    },
    
    # === METAL ===
    'Metal': {
        'contexts': ['#Festival', '#Bar'],
        'subgenres': [
            'Heavy Metal', 'Thrash Metal', 'Death Metal',
            'Black Metal', 'Power Metal', 'Progressive Metal',
            'Doom Metal', 'Sludge Metal', 'Alternative Metal',
            'Nu Metal', 'Metalcore', 'Deathcore', 'Post-Metal',
            'Symphonic Metal', 'Folk Metal', 'Industrial Metal'
        ]
    },
    
    # === CLASSICAL ===
    'Classical': {
        'contexts': ['#CocktailChic', '#Restaurant', '#CorporateEvent', '#Mariage'],
        'subgenres': [
            'Baroque', 'Classical Period', 'Romantic', 'Modern Classical',
            'Contemporary Classical', 'Opera', 'Chamber Music',
            'Symphonic', 'Choral', 'Minimalism', 'Neoclassical'
        ]
    },
    
    # === WORLD MUSIC ===
    'World': {
        'contexts': ['#Restaurant', '#CocktailChic', '#Festival'],
        'subgenres': [
            'African', 'Middle Eastern', 'Indian', 'Asian',
            'Celtic', 'Balkan', 'Mediterranean', 'Nordic',
            'Bhangra', 'Qawwali', 'Rai', 'Klezmer',
            'Gamelan', 'Taiko', 'Flamenco', 'Fado'
        ]
    },
    
    # === FUNK/DISCO ===
    'Funk': {
        'contexts': ['#Club', '#Mariage', '#CorporateEvent', '#Bar'],
        'subgenres': [
            'Classic Funk', 'P-Funk', 'Disco', 'Nu-Disco',
            'Boogie', 'Electro Funk', 'Go-Go', 'Funk Rock',
            'Jazz Funk', 'Psychedelic Funk', 'Minneapolis Sound'
        ]
    },
    
    # === AMBIENT/CHILL ===
    'Ambient': {
        'contexts': ['#Restaurant', '#CocktailChic', '#Brunch'],
        'subgenres': [
            'Dark Ambient', 'Ambient House', 'Ambient Techno',
            'Drone', 'New Age', 'Space Music', 'Meditation',
            'Nature Sounds', 'Binaural Beats', 'Lo-Fi'
        ]
    },
    
    # === INDIE ===
    'Indie': {
        'contexts': ['#Bar', '#Brunch', '#CocktailChic'],
        'subgenres': [
            'Indie Rock', 'Indie Pop', 'Indie Folk',
            'Indie Electronic', 'Lo-Fi', 'Shoegaze',
            'Post-Punk Revival', 'Math Rock', 'Emo'
        ]
    },
    
    # === GOSPEL/RELIGIOUS ===
    'Gospel': {
        'contexts': ['#Mariage', '#CorporateEvent'],
        'subgenres': [
            'Contemporary Gospel', 'Traditional Gospel',
            'Urban Gospel', 'Gospel Blues', 'Gospel Jazz',
            'Southern Gospel', 'Praise & Worship'
        ]
    }
}

### RÈGLES D'ASSOCIATION AUTOMATIQUE FLOWTAG

FLOWTAG_AUTO_RULES = {
    # Énergie → Moments
    'energy_to_moment': {
        (1, 3): ['#Closing'],
        (4, 6): ['#Warmup'],
        (7, 10): ['#Peaktime']
    },
    
    # BPM → Moments (guideline seulement)
    'bpm_to_moment': {
        (60, 100): ['#Closing'],
        (100, 125): ['#Warmup'],
        (125, 150): ['#Peaktime'],
        (150, 200): ['#Peaktime']  # Drum & Bass, Hardcore
    },
    
    # Année → Styles
    'year_to_style': {
        (1950, 1969): ['#Classics'],
        (1970, 1979): ['#Classics', '#Funky'],
        (1980, 1989): ['#Classics'],
        (1990, 1999): ['#Classics'],
        (2000, 2019): [],  # Potentiellement classics si populaire
        (2020, 2030): []   # Trop récent pour être classics
    },
    
    # Popularité → Contextes additionnels
    'popularity_to_contexts': {
        (80, 100): ['#Mariage', '#CorporateEvent', '#Anniversaire'],
        (60, 79): ['#Bar', '#Club'],
        (0, 59): []  # Pas de contextes additionnels
    }
}

### MAPPING INTELLIGENT GENRE → CONTEXTES FLOWTAG

def get_genre_contexts(genre, subgenre=None):
    """
    Retourne les contextes FlowTag appropriés pour un genre/sous-genre.
    La fonction recherche d'abord le genre principal, puis affine avec
    des règles spécifiques au sous-genre pour une plus grande précision.
    """
    if not genre:
        return ['#Bar', '#CorporateEvent'] # Contexte par défaut

    # Cherche le genre principal dans la base de données
    for main_genre, data in FLOWTAG_GENRES.items():
        # Recherche flexible (ex: 'Hip-Hop/Rap' correspond à 'hip-hop')
        if genre.lower() in main_genre.lower().replace('/', ' '):
            base_contexts = data.get('contexts', [])
            
            # Ajustements spécifiques basés sur le sous-genre
            if subgenre:
                subgenre_lower = subgenre.lower()
                
                # Règles spéciales pour des mots-clés dans le sous-genre
                if any(keyword in subgenre_lower for keyword in ['chill', 'ambient', 'lo-fi', 'downtempo']):
                    return ['#Restaurant', '#CocktailChic', '#Brunch']
                if any(keyword in subgenre_lower for keyword in ['party', 'dance', 'club', 'festival']):
                    return ['#Club', '#Mariage', '#Anniversaire', '#Peaktime']
                if 'wedding' in subgenre_lower:
                    return ['#Mariage', '#CorporateEvent', '#CocktailChic']
                if 'lounge' in subgenre_lower:
                    return ['#Bar', '#CocktailChic', '#Restaurant']
                    
            return base_contexts
    
    # Si le genre n'est pas trouvé, retourne des contextes par défaut
    return ['#Bar', '#CorporateEvent'] 